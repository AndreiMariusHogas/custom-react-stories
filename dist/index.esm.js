import{jsxs as e,jsx as n}from"react/jsx-runtime";import{createContext as t,useState as r,useRef as o,Fragment as i,useEffect as u,useContext as s,forwardRef as c,useMemo as l,useImperativeHandle as a}from"react";var d=function(){return d=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},d.apply(this,arguments)},v=t({stories:[],width:"100%",height:"100%",defaultDuration:1e4,isPaused:!1});Object.freeze({MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",TOUCH_START:"touchStart",TOUCH_END:"touchEnd"});var f=Object.freeze({LEFT:"left",RIGHT:"right"}),y="Actions-styles_left__eky50",m="Actions-styles_right__zguoH";function h(t){var u=t.onNextClick,s=t.onPrevClick,c=t.onPause,l=t.onResume,a=r(!1),v=a[0],h=a[1],p=o(null);function _(e){e.stopPropagation(),e.preventDefault(),clearTimeout(p.current),p.current=setTimeout((function(){c(),h(!0)}),200)}function g(e,n){if(n.stopPropagation(),n.preventDefault(),clearTimeout(p.current),v)return l(),void h(!1);l(),e!=f.LEFT?u():s()}function w(e){return{onMouseUp:function(n){return g(e,n)},onTouchEnd:function(n){return g(e,n)},onTouchStart:function(e){return _(e)},onMouseDown:function(e){return _(e)}}}return e(i,{children:[n("div",d({className:y},w(f.LEFT))),n("div",d({className:m},w(f.RIGHT)))]})}function p(){return s(v)}var _="ProgressBar-styles_wrapper__oqUCo",g="ProgressBar-styles_bar__x0O50";function w(e){var t,i,s,c,l,a=p().defaultDuration,v=o(null),f=o(null),y=r(!1),m=y[0],h=y[1],w=0,x=.1;return u((function(){e.isPaused?h(!1):e.isActive?h(!0):h(!1)}),[e.isActive,e.isPaused]),u((function(){e.isActive&&v.current&&(v.current.style.width="0px")}),[e.isActive]),u((function(){var n;v.current&&(e.hasStoryPassed?v.current.style.width="".concat(null===(n=null==f?void 0:f.current)||void 0===n?void 0:n.offsetWidth,"px"):e.isActive||(v.current.style.width="0px"))}),[e.hasStoryPassed,e.isActive]),t=function(n){var t;v.current&&f.current&&((w=Number((v.current.style.width||"1px").slice(0,v.current.style.width.length-2))||0)>f.current.offsetWidth?h(!1):(x=(null===(t=null==f?void 0:f.current)||void 0===t?void 0:t.offsetWidth)/((e.story.duration||a)/n),v.current.style.width="".concat(w+x,"px")))},i=m,s=o(),c=o(),l=o(t),u((function(){l.current=t}),[t]),u((function(){return!1!==i?(s.current=requestAnimationFrame((function e(n){if(null!=c.current){var t=n-c.current;l.current(t)}c.current=n,s.current=requestAnimationFrame(e)})),function(){cancelAnimationFrame(s.current),s.current=null,c.current=null}):function(){s.current&&(s.current=null),cancelAnimationFrame(s.current),c.current=null}}),[i]),n("div",d({className:_,ref:f},{children:n("div",{className:g,ref:v})}))}var x="progress-styles_wrapper__qQPyW";function M(e){var t=p().stories;return n("div",d({className:x,style:{gridTemplateColumns:"repeat(".concat(t.length,",1fr)")}},{children:t.map((function(t){return n(w,{hasStoryPassed:t.index<e.activeStoryIndex,isActive:t.index===e.activeStoryIndex,story:t,isPaused:t.index===e.activeStoryIndex&&e.isPaused},t.index)}))}))}var S=Object.freeze({IMAGE:"image",VIDEO:"video",COMPONENT:"component"}),P="Story-styles_wrapper__oJP7j",C="Story-styles_header__-rnWL",N="Image-styles_image__gnfW1";function T(e){return u((function(){e.onPause()}),[]),n("img",{className:N,src:e.story.url,alt:"story",onLoad:function(){setTimeout((function(){e.onResume()}),4)}})}var I,O="Video-styles_video__BykuO",A="Video-styles_loaderWrapper__TqVWk",D="Video-styles_loader__FxxSV",E="Video-styles_soundIcon__ZvYXE";function b(e){return"off"===e.type?n("svg",d({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:n("path",{d:"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm17.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"})})):n("svg",d({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:n("path",{d:"M22 0v24l-11-6v-2.278l9 4.909v-17.262l-9 4.91v-2.279l11-6zm-13 6v12h-7v-12h7zm-2 2h-3v8h3v-8z"})}))}var k="RSIsMute",W="undefined"==typeof window?{}:window;function R(t){var s,c=p().isPaused,l=r("true"===(null===(s=null==W?void 0:W.localStorage)||void 0===s?void 0:s.getItem(k))),a=l[0],v=l[1],f=r(!1),y=f[0],m=f[1],h=o(null);function _(e){var n;null===(n=null==W?void 0:W.localStorage)||void 0===n||n.setItem(k,String(e)),v(e)}return u((function(){t.onPause(),m(!0)}),[]),u((function(){h.current&&(!c||h.current.paused?h.current.play().catch((function(){var e;_(!0),null===(e=h.current)||void 0===e||e.play()})):h.current.pause())}),[c]),e(i,{children:[e("video",d({className:O,ref:h,playsInline:!0,"webkit-playsinline":"",controls:!1,src:t.story.url,onLoadedData:function(){setTimeout((function(){t.onResume(),m(!1)}),4)},muted:a},{children:[n("source",{src:t.story.url,type:"video/mp4"}),n("source",{src:t.story.url,type:"video/webm"}),n("source",{src:t.story.url,type:"video/ogg"}),n("p",{children:"Video not supported"})]})),n("div",d({className:E,onClick:function(){return _(!a)}},{children:n(b,{type:a?"off":"on"})})),y&&n("div",d({className:A},{children:n("div",{className:D})}))]})}null===(I=null==W?void 0:W.localStorage)||void 0===I||I.setItem(k,"true");var z="CustomComponents-styles_component__w87Wx";function F(e){return n("div",d({className:z},{children:n(e.story.component,{pause:e.onPause,resume:e.onResume,story:e.story})}))}var V="SeeMore-styles_seeMoreWrapper__kwjif",j="SeeMore-styles_defaultSeeMore__-B1QW";function U(t){return t.story.seeMore?n("button",d({type:"button",onClick:function(){t.onSeeMoreClick()},className:V},{children:function(){var r=t.story.seeMore,o=typeof r;if(["string","boolean"].includes(o)){var i="string"===o?r:"See More";return e("div",d({className:j},{children:[n("span",{children:"^"}),n("p",{children:i})]}))}return"function"===o?n(t.story.seeMore,{}):t.story.seeMore}()})):null}var L="SeeMoreComponent-styles_seeMoreComponentWrapper__0T6Ap",B="SeeMoreComponent-styles_closeIcon__LMm3b";function q(t){return t.story.seeMore&&t.story.seeMoreComponent?e("div",d({className:L},{children:[n("button",d({className:B,onClick:t.onClose},{children:"âœ•"})),"function"==typeof t.story.seeMoreComponent?n(t.story.seeMoreComponent,{}):t.story.seeMoreComponent]})):null}function H(t){var o=r(!1),i=o[0],s=o[1];return u((function(){s(!1)}),[t.story]),e("div",d({className:P},{children:[t.story.type===S.IMAGE?n(T,d({},t)):t.story.type===S.VIDEO?n(R,d({},t)):t.story.type===S.COMPONENT?n(F,d({},t)):null,t.story.header&&n("div",d({className:C},{children:"function"==typeof t.story.header?n(t.story.header,{}):t.story.header})),n(U,{onSeeMoreClick:function(){var e,n;t.onPause(),s(!0),null===(n=(e=t.story).onSeeMoreClick)||void 0===n||n.call(e,t.story.index)},story:t.story}),i&&n(q,{story:t.story,onClose:function(){t.onResume(),s(!1)}})]}))}var G="styles_main__-0FEu";function Q(e){return void 0===e&&(e=4),Number(Math.random().toFixed(e))}var J=c((function(t,i){var s,c,f,y,m,p,_,g=t.stories,w=void 0===g?[]:g,x=t.width,S=void 0===x?"100%":x,P=t.height,C=void 0===P?"100%":P,N=t.onStoryChange,T=void 0===N?function(){}:N,I=t.currentIndex,O=void 0===I?0:I,A=t.defaultDuration,D=void 0===A?1e4:A,E=t.onAllStoriesEnd,b=void 0===E?function(){}:E,k=t.onStoriesStart,W=void 0===k?function(){}:k,R=t.onRepeatPrev,z=void 0===R?function(){}:R,F=l((function(){return function(e,n){var t=0;return e.map((function(e,r){var o=e.duration||n,i=o+Q();return i===t&&(i=o+Q(6)),t=i,d(d({},e),{index:r,calculatedDuration:i})}))}(w,D)}),[w,D]),V=r(),j=V[0],U=V[1],L=w.length-1,B=r(!1),q=B[0],J=B[1],X=o(!1),Y=o(!1);function Z(){X.current||(null==j?void 0:j.index)!==L||(b(),X.current=!0),(null==j?void 0:j.index)!==L?(0===(null==j?void 0:j.index)&&(X.current=!1),U((function(e){if(!e)return F[0];var n=(null==e?void 0:e.index)+1;return F[n]}))):Y.current=!1}function K(){0!==(null==j?void 0:j.index)?U((function(e){if(!e)return F[0];var n=(null==e?void 0:e.index)-1;return F[n]})):Y.current&&z()}function $(){J(!0)}function ee(){J(!1)}u((function(){Y.current||(Y.current=!0,W())}),[W]),u((function(){var e=F[O];e&&U(e)}),[O,w]),a(i,(function(){return{next:function(){Z()},previous:function(){K()}}})),u((function(){j&&T(j.index)}),[j]),c=function(){Z()},f=null!==(s=null==j?void 0:j.calculatedDuration)&&void 0!==s?s:null,y=q,m=o(),p=o(f),_=o(Date.now()),u((function(){m.current=c}),[c]),u((function(){p.current=f}),[f]),u((function(){if(null!==f&&!1===y){_.current=Date.now();var e=setTimeout((function(){m.current()}),p.current);return function(){clearTimeout(e)}}return function(){}}),[f,y]),u((function(){y&&(p.current=p.current-(Date.now()-_.current))}),[y]);var ne={stories:F,width:S,height:C,defaultDuration:D,isPaused:q};return j?n(v.Provider,d({value:ne},{children:e("div",d({className:G,style:{width:S,height:C}},{children:[n(M,{activeStoryIndex:j.index,isPaused:q}),n(H,{onPause:$,onResume:ee,story:j},j.index),n(h,{onNextClick:Z,onPrevClick:K,onPause:$,onResume:ee})]}))})):null}));export{J as default};
//# sourceMappingURL=index.esm.js.map
