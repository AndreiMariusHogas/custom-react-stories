"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},r=t.createContext({stories:[],width:"100%",height:"100%",defaultDuration:1e4,isPaused:!1});Object.freeze({MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",TOUCH_START:"touchStart",TOUCH_END:"touchEnd"});var o=Object.freeze({LEFT:"left",RIGHT:"right"}),s="Actions-styles_left__eky50",u="Actions-styles_right__zguoH";function i(r){var i=r.onNextClick,c=r.onPrevClick,l=r.onPause,a=r.onResume,f=t.useState(!1),d=f[0],v=f[1],y=t.useRef(null);function m(e){e.stopPropagation(),e.preventDefault(),clearTimeout(y.current),y.current=setTimeout((function(){l(),v(!0)}),200)}function x(e,t){if(t.stopPropagation(),t.preventDefault(),clearTimeout(y.current),d)return a(),void v(!1);a(),e!=o.LEFT?i():c()}function h(e){return{onMouseUp:function(t){return x(e,t)},onTouchEnd:function(t){return x(e,t)},onTouchStart:function(e){return m(e)},onMouseDown:function(e){return m(e)}}}return e.jsxs(t.Fragment,{children:[e.jsx("div",n({className:s},h(o.LEFT))),e.jsx("div",n({className:u},h(o.RIGHT)))]})}function c(){return t.useContext(r)}var l="ProgressBar-styles_wrapper__oqUCo",a="ProgressBar-styles_bar__x0O50";function f(r){var o,s,u,i,f,d=c().defaultDuration,v=t.useRef(null),y=t.useRef(null),m=t.useState(!1),x=m[0],h=m[1],p=0,_=.1;return t.useEffect((function(){r.isPaused?h(!1):r.isActive?h(!0):h(!1)}),[r.isActive,r.isPaused]),t.useEffect((function(){r.isActive&&v.current&&(v.current.style.width="0px")}),[r.isActive]),t.useEffect((function(){var e;v.current&&(r.hasStoryPassed?v.current.style.width="".concat(null===(e=null==y?void 0:y.current)||void 0===e?void 0:e.offsetWidth,"px"):r.isActive||(v.current.style.width="0px"))}),[r.hasStoryPassed,r.isActive]),o=function(e){var t;v.current&&y.current&&((p=Number((v.current.style.width||"1px").slice(0,v.current.style.width.length-2))||0)>y.current.offsetWidth?h(!1):(_=(null===(t=null==y?void 0:y.current)||void 0===t?void 0:t.offsetWidth)/((r.story.duration||d)/e),v.current.style.width="".concat(p+_,"px")))},s=x,u=t.useRef(),i=t.useRef(),f=t.useRef(o),t.useEffect((function(){f.current=o}),[o]),t.useEffect((function(){return!1!==s?(u.current=requestAnimationFrame((function e(t){if(null!=i.current){var n=t-i.current;f.current(n)}i.current=t,u.current=requestAnimationFrame(e)})),function(){cancelAnimationFrame(u.current),u.current=null,i.current=null}):function(){u.current&&(u.current=null),cancelAnimationFrame(u.current),i.current=null}}),[s]),e.jsx("div",n({className:l,ref:y},{children:e.jsx("div",{className:a,ref:v})}))}var d="progress-styles_wrapper__qQPyW";function v(t){var r=c().stories;return e.jsx("div",n({className:d,style:{gridTemplateColumns:"repeat(".concat(r.length,",1fr)")}},{children:r.map((function(n){return e.jsx(f,{hasStoryPassed:n.index<t.activeStoryIndex,isActive:n.index===t.activeStoryIndex,story:n,isPaused:n.index===t.activeStoryIndex&&t.isPaused},n.index)}))}))}var y=Object.freeze({IMAGE:"image",VIDEO:"video",COMPONENT:"component"}),m="Story-styles_wrapper__oJP7j",x="Story-styles_header__-rnWL",h="Image-styles_image__gnfW1";function p(n){return t.useEffect((function(){n.onPause()}),[]),e.jsx("img",{className:h,src:n.story.url,alt:"story",onLoad:function(){setTimeout((function(){n.onResume()}),4)}})}var _,j="Video-styles_video__BykuO",g="Video-styles_loaderWrapper__TqVWk",w="Video-styles_loader__FxxSV",S="Video-styles_soundIcon__ZvYXE";function M(t){return"off"===t.type?e.jsx("svg",n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:e.jsx("path",{d:"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm17.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"})})):e.jsx("svg",n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:e.jsx("path",{d:"M22 0v24l-11-6v-2.278l9 4.909v-17.262l-9 4.91v-2.279l11-6zm-13 6v12h-7v-12h7zm-2 2h-3v8h3v-8z"})}))}var E="RSIsMute",P="undefined"==typeof window?{}:window;function C(r){var o,s=c().isPaused,u=t.useState("true"===(null===(o=null==P?void 0:P.localStorage)||void 0===o?void 0:o.getItem(E))),i=u[0],l=u[1],a=t.useState(!1),f=a[0],d=a[1],v=t.useRef(null);function y(e){var t;null===(t=null==P?void 0:P.localStorage)||void 0===t||t.setItem(E,String(e)),l(e)}return t.useEffect((function(){r.onPause(),d(!0)}),[]),t.useEffect((function(){v.current&&(!s||v.current.paused?v.current.play().catch((function(){var e;y(!0),null===(e=v.current)||void 0===e||e.play()})):v.current.pause())}),[s]),e.jsxs(t.Fragment,{children:[e.jsxs("video",n({className:j,ref:v,playsInline:!0,"webkit-playsinline":"",controls:!1,src:r.story.url,onLoadedData:function(){setTimeout((function(){r.onResume(),d(!1)}),4)},muted:i},{children:[e.jsx("source",{src:r.story.url,type:"video/mp4"}),e.jsx("source",{src:r.story.url,type:"video/webm"}),e.jsx("source",{src:r.story.url,type:"video/ogg"}),e.jsx("p",{children:"Video not supported"})]})),e.jsx("div",n({className:S,onClick:function(){return y(!i)}},{children:e.jsx(M,{type:i?"off":"on"})})),f&&e.jsx("div",n({className:g},{children:e.jsx("div",{className:w})}))]})}null===(_=null==P?void 0:P.localStorage)||void 0===_||_.setItem(E,"true");var N="CustomComponents-styles_component__w87Wx";function R(t){return e.jsx("div",n({className:N},{children:e.jsx(t.story.component,{pause:t.onPause,resume:t.onResume,story:t.story})}))}var T="SeeMore-styles_seeMoreWrapper__kwjif",I="SeeMore-styles_defaultSeeMore__-B1QW";function O(t){return t.story.seeMore?e.jsx("button",n({type:"button",onClick:function(){t.onSeeMoreClick()},className:T},{children:function(){var r=t.story.seeMore,o=typeof r;if(["string","boolean"].includes(o)){var s="string"===o?r:"See More";return e.jsxs("div",n({className:I},{children:[e.jsx("span",{children:"^"}),e.jsx("p",{children:s})]}))}return"function"===o?e.jsx(t.story.seeMore,{}):t.story.seeMore}()})):null}var A="SeeMoreComponent-styles_seeMoreComponentWrapper__0T6Ap",D="SeeMoreComponent-styles_closeIcon__LMm3b";function b(t){return t.story.seeMore&&t.story.seeMoreComponent?e.jsxs("div",n({className:A},{children:[e.jsx("button",n({className:D,onClick:t.onClose},{children:"âœ•"})),"function"==typeof t.story.seeMoreComponent?e.jsx(t.story.seeMoreComponent,{}):t.story.seeMoreComponent]})):null}function k(r){var o=t.useState(!1),s=o[0],u=o[1];return t.useEffect((function(){u(!1)}),[r.story]),e.jsxs("div",n({className:m},{children:[r.story.type===y.IMAGE?e.jsx(p,n({},r)):r.story.type===y.VIDEO?e.jsx(C,n({},r)):r.story.type===y.COMPONENT?e.jsx(R,n({},r)):null,r.story.header&&e.jsx("div",n({className:x},{children:"function"==typeof r.story.header?e.jsx(r.story.header,{}):r.story.header})),e.jsx(O,{onSeeMoreClick:function(){var e,t;r.onPause(),u(!0),null===(t=(e=r.story).onSeeMoreClick)||void 0===t||t.call(e,r.story.index)},story:r.story}),s&&e.jsx(b,{story:r.story,onClose:function(){r.onResume(),u(!1)}})]}))}var W="styles_main__-0FEu";function F(e){return void 0===e&&(e=4),Number(Math.random().toFixed(e))}var z=t.forwardRef((function(o,s){var u,c,l,a,f,d,y,m=o.stories,x=void 0===m?[]:m,h=o.width,p=void 0===h?"100%":h,_=o.height,j=void 0===_?"100%":_,g=o.onStoryChange,w=void 0===g?function(){}:g,S=o.currentIndex,M=void 0===S?0:S,E=o.defaultDuration,P=void 0===E?1e4:E,C=o.onAllStoriesEnd,N=void 0===C?function(){}:C,R=o.onStoriesStart,T=void 0===R?function(){}:R,I=o.onRepeatPrev,O=void 0===I?function(){}:I,A=t.useMemo((function(){return function(e,t){var r=0;return e.map((function(e,o){var s=e.duration||t,u=s+F();return u===r&&(u=s+F(6)),r=u,n(n({},e),{index:o,calculatedDuration:u})}))}(x,P)}),[x,P]),D=t.useState(),b=D[0],z=D[1],V=x.length-1,U=t.useState(!1),q=U[0],L=U[1],B=t.useRef(!1),H=t.useRef(!1);function G(){B.current||(null==b?void 0:b.index)!==V||(N(),B.current=!0),(null==b?void 0:b.index)!==V?(0===(null==b?void 0:b.index)&&(B.current=!1),z((function(e){if(!e)return A[0];var t=(null==e?void 0:e.index)+1;return A[t]}))):H.current=!1}function Q(){0!==(null==b?void 0:b.index)?z((function(e){if(!e)return A[0];var t=(null==e?void 0:e.index)-1;return A[t]})):H.current&&O()}function J(){L(!0)}function X(){L(!1)}t.useEffect((function(){H.current||(H.current=!0,T())}),[T]),t.useEffect((function(){var e=A[M];e&&z(e)}),[M,x]),t.useImperativeHandle(s,(function(){return{next:function(){G()},previous:function(){Q()}}})),t.useEffect((function(){b&&w(b.index)}),[b]),c=function(){G()},l=null!==(u=null==b?void 0:b.calculatedDuration)&&void 0!==u?u:null,a=q,f=t.useRef(),d=t.useRef(l),y=t.useRef(Date.now()),t.useEffect((function(){f.current=c}),[c]),t.useEffect((function(){d.current=l}),[l]),t.useEffect((function(){if(null!==l&&!1===a){y.current=Date.now();var e=setTimeout((function(){f.current()}),d.current);return function(){clearTimeout(e)}}return function(){}}),[l,a]),t.useEffect((function(){a&&(d.current=d.current-(Date.now()-y.current))}),[a]);var Y={stories:A,width:p,height:j,defaultDuration:P,isPaused:q};return b?e.jsx(r.Provider,n({value:Y},{children:e.jsxs("div",n({className:W,style:{width:p,height:j}},{children:[e.jsx(v,{activeStoryIndex:b.index,isPaused:q}),e.jsx(k,{onPause:J,onResume:X,story:b},b.index),e.jsx(i,{onNextClick:G,onPrevClick:Q,onPause:J,onResume:X})]}))})):null}));module.exports=z;
//# sourceMappingURL=index.js.map
