"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},r=t.createContext({stories:[],width:"100%",height:"100%",defaultDuration:1e4,isPaused:!1});Object.freeze({MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",TOUCH_START:"touchStart",TOUCH_END:"touchEnd"});var o=Object.freeze({LEFT:"left",RIGHT:"right"}),i="Actions-styles_left__eky50",s="Actions-styles_right__zguoH";function u(r){var u=r.onNextClick,c=r.onPrevClick,l=r.onPause,a=r.onResume,d=t.useState(!1),v=d[0],f=d[1],y=t.useRef(null);function m(e){e.stopPropagation(),e.preventDefault(),clearTimeout(y.current),y.current=setTimeout((function(){l(),f(!0)}),200)}function h(e,t){if(t.stopPropagation(),t.preventDefault(),clearTimeout(y.current),v)return a(),void f(!1);a(),e!=o.LEFT?u():c()}function x(e){return{onMouseUp:function(t){return h(e,t)},onTouchEnd:function(t){return h(e,t)},onTouchStart:function(e){return m(e)},onMouseDown:function(e){return m(e)}}}return e.jsxs(t.Fragment,{children:[e.jsx("div",n({className:i},x(o.LEFT)),void 0),e.jsx("div",n({className:s},x(o.RIGHT)),void 0)]},void 0)}function c(){return t.useContext(r)}var l="ProgressBar-styles_wrapper__oqUCo",a="ProgressBar-styles_bar__x0O50";function d(r){var o,i,s,u,d,v=c().defaultDuration,f=t.useRef(null),y=t.useRef(null),m=t.useState(!1),h=m[0],x=m[1],p=0,_=.1;return t.useEffect((function(){r.isPaused?x(!1):r.isActive?x(!0):x(!1)}),[r.isActive,r.isPaused]),t.useEffect((function(){r.isActive&&f.current&&(f.current.style.width="0px")}),[r.isActive]),t.useEffect((function(){var e;f.current&&(r.hasStoryPassed?f.current.style.width="".concat(null===(e=null==y?void 0:y.current)||void 0===e?void 0:e.offsetWidth,"px"):r.isActive||(f.current.style.width="0px"))}),[r.hasStoryPassed,r.isActive]),o=function(e){var t;f.current&&y.current&&((p=Number((f.current.style.width||"1px").slice(0,f.current.style.width.length-2))||0)>y.current.offsetWidth?x(!1):(_=(null===(t=null==y?void 0:y.current)||void 0===t?void 0:t.offsetWidth)/((r.story.duration||v)/e),f.current.style.width="".concat(p+_,"px")))},i=h,s=t.useRef(),u=t.useRef(),d=t.useRef(o),t.useEffect((function(){d.current=o}),[o]),t.useEffect((function(){return!1!==i?(s.current=requestAnimationFrame((function e(t){if(null!=u.current){var n=t-u.current;d.current(n)}u.current=t,s.current=requestAnimationFrame(e)})),function(){cancelAnimationFrame(s.current),s.current=null,u.current=null}):function(){s.current&&(s.current=null),cancelAnimationFrame(s.current),u.current=null}}),[i]),e.jsx("div",n({className:l,ref:y},{children:e.jsx("div",{className:a,ref:f},void 0)}),void 0)}var v="progress-styles_wrapper__qQPyW";function f(t){var r=c().stories;return e.jsx("div",n({className:v,style:{gridTemplateColumns:"repeat(".concat(r.length,",1fr)")}},{children:r.map((function(n){return e.jsx(d,{hasStoryPassed:n.index<t.activeStoryIndex,isActive:n.index===t.activeStoryIndex,story:n,isPaused:n.index===t.activeStoryIndex&&t.isPaused},n.index)}))}),void 0)}var y=Object.freeze({IMAGE:"image",VIDEO:"video",COMPONENT:"component"}),m="Story-styles_wrapper__oJP7j",h="Story-styles_header__-rnWL",x="Image-styles_image__gnfW1";function p(n){return t.useEffect((function(){n.onPause()}),[]),e.jsx("img",{className:x,src:n.story.url,alt:"story",onLoad:function(){setTimeout((function(){n.onResume()}),4)}},void 0)}var _,j="Video-styles_video__BykuO",g="Video-styles_loaderWrapper__TqVWk",w="Video-styles_loader__FxxSV",S="Video-styles_soundIcon__ZvYXE";function M(t){return"off"===t.type?e.jsx("svg",n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:e.jsx("path",{d:"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm17.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"},void 0)}),void 0):e.jsx("svg",n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:e.jsx("path",{d:"M22 0v24l-11-6v-2.278l9 4.909v-17.262l-9 4.91v-2.279l11-6zm-13 6v12h-7v-12h7zm-2 2h-3v8h3v-8z"},void 0)}),void 0)}var E="RSIsMute",P="undefined"==typeof window?{}:window;function C(r){var o,i=c().isPaused,s=t.useState("true"===(null===(o=null==P?void 0:P.localStorage)||void 0===o?void 0:o.getItem(E))),u=s[0],l=s[1],a=t.useState(!1),d=a[0],v=a[1],f=t.useRef(null);function y(e){var t;null===(t=null==P?void 0:P.localStorage)||void 0===t||t.setItem(E,String(e)),l(e)}return t.useEffect((function(){r.onPause(),v(!0)}),[]),t.useEffect((function(){f.current&&(!i||f.current.paused?f.current.play().catch((function(){var e;y(!0),null===(e=f.current)||void 0===e||e.play()})):f.current.pause())}),[i]),e.jsxs(t.Fragment,{children:[e.jsxs("video",n({className:j,ref:f,playsInline:!0,"webkit-playsinline":"",controls:!1,src:r.story.url,onLoadedData:function(){setTimeout((function(){r.onResume(),v(!1)}),4)},muted:u},{children:[e.jsx("source",{src:r.story.url,type:"video/mp4"},void 0),e.jsx("source",{src:r.story.url,type:"video/webm"},void 0),e.jsx("source",{src:r.story.url,type:"video/ogg"},void 0),e.jsx("p",{children:"Video not supported"},void 0)]}),void 0),e.jsx("div",n({className:S,onClick:function(){return y(!u)}},{children:e.jsx(M,{type:u?"off":"on"},void 0)}),void 0),d&&e.jsx("div",n({className:g},{children:e.jsx("div",{className:w},void 0)}),void 0)]},void 0)}null===(_=null==P?void 0:P.localStorage)||void 0===_||_.setItem(E,"true");var N="CustomComponents-styles_component__w87Wx";function R(t){return e.jsx("div",n({className:N},{children:e.jsx(t.story.component,{pause:t.onPause,resume:t.onResume,story:t.story},void 0)}),void 0)}var T="SeeMore-styles_seeMoreWrapper__kwjif",I="SeeMore-styles_defaultSeeMore__-B1QW";function O(t){return t.story.seeMore?e.jsx("button",n({type:"button",onClick:function(){t.onSeeMoreClick()},className:T},{children:function(){var r=t.story.seeMore,o=typeof r;if(["string","boolean"].includes(o)){var i="string"===o?r:"See More";return e.jsxs("div",n({className:I},{children:[e.jsx("span",{children:"^"},void 0),e.jsx("p",{children:i},void 0)]}),void 0)}return"function"===o?e.jsx(t.story.seeMore,{},void 0):t.story.seeMore}()}),void 0):null}var A="SeeMoreComponent-styles_seeMoreComponentWrapper__0T6Ap",D="SeeMoreComponent-styles_closeIcon__LMm3b";function b(t){return t.story.seeMore&&t.story.seeMoreComponent?e.jsxs("div",n({className:A},{children:[e.jsx("button",n({className:D,onClick:t.onClose},{children:"âœ•"}),void 0),"function"==typeof t.story.seeMoreComponent?e.jsx(t.story.seeMoreComponent,{},void 0):t.story.seeMoreComponent]}),void 0):null}function k(r){var o=t.useState(!1),i=o[0],s=o[1];return t.useEffect((function(){s(!1)}),[r.story]),e.jsxs("div",n({className:m},{children:[r.story.type===y.IMAGE?e.jsx(p,n({},r),void 0):r.story.type===y.VIDEO?e.jsx(C,n({},r),void 0):r.story.type===y.COMPONENT?e.jsx(R,n({},r),void 0):null,r.story.header&&e.jsx("div",n({className:h},{children:"function"==typeof r.story.header?e.jsx(r.story.header,{},void 0):r.story.header}),void 0),e.jsx(O,{onSeeMoreClick:function(){var e,t;r.onPause(),s(!0),null===(t=(e=r.story).onSeeMoreClick)||void 0===t||t.call(e,r.story.index)},story:r.story},void 0),i&&e.jsx(b,{story:r.story,onClose:function(){r.onResume(),s(!1)}},void 0)]}),void 0)}var W="styles_main__-0FEu";function F(e){return void 0===e&&(e=4),Number(Math.random().toFixed(e))}module.exports=function(o){var i,s,c,l,a,d,v,y=o.stories,m=void 0===y?[]:y,h=o.width,x=void 0===h?"100%":h,p=o.height,_=void 0===p?"100%":p,j=o.onStoryChange,g=void 0===j?function(){}:j,w=o.currentIndex,S=void 0===w?0:w,M=o.defaultDuration,E=void 0===M?1e4:M,P=o.onAllStoriesEnd,C=void 0===P?function(){}:P,N=o.onStoriesStart,R=void 0===N?function(){}:N,T=o.onRepeatPrev,I=void 0===T?function(){}:T,O=t.useMemo((function(){return function(e,t){var r=0;return e.map((function(e,o){var i=e.duration||t,s=i+F();return s===r&&(s=i+F(6)),r=s,n(n({},e),{index:o,calculatedDuration:s})}))}(m,E)}),[m,E]),A=t.useState(),D=A[0],b=A[1],z=m.length-1,V=t.useState(!1),U=V[0],q=V[1],L=t.useRef(!1),B=t.useRef(!1);function H(){L.current||(null==D?void 0:D.index)!==z||(C(),L.current=!0),(null==D?void 0:D.index)!==z?(0===(null==D?void 0:D.index)&&(L.current=!1),b((function(e){if(!e)return O[0];var t=(null==e?void 0:e.index)+1;return O[t]}))):B.current=!1}function G(){q(!0)}function Q(){q(!1)}t.useEffect((function(){B.current||(B.current=!0,R())}),[R]),t.useEffect((function(){var e=O[S];e&&b(e)}),[S,m]),t.useEffect((function(){D&&g(D.index)}),[D]),s=function(){H()},c=null!==(i=null==D?void 0:D.calculatedDuration)&&void 0!==i?i:null,l=U,a=t.useRef(),d=t.useRef(c),v=t.useRef(Date.now()),t.useEffect((function(){a.current=s}),[s]),t.useEffect((function(){d.current=c}),[c]),t.useEffect((function(){if(null!==c&&!1===l){v.current=Date.now();var e=setTimeout((function(){a.current()}),d.current);return function(){clearTimeout(e)}}return function(){}}),[c,l]),t.useEffect((function(){l&&(d.current=d.current-(Date.now()-v.current))}),[l]);var J={stories:O,width:x,height:_,defaultDuration:E,isPaused:U};return D?e.jsx(r.Provider,n({value:J},{children:e.jsxs("div",n({className:W,style:{width:x,height:_}},{children:[e.jsx(f,{activeStoryIndex:D.index,isPaused:U},void 0),e.jsx(k,{onPause:G,onResume:Q,story:D},D.index),e.jsx(u,{onNextClick:H,onPrevClick:function(){0!==(null==D?void 0:D.index)?b((function(e){if(!e)return O[0];var t=(null==e?void 0:e.index)-1;return O[t]})):B.current&&I()},onPause:G,onResume:Q},void 0)]}),void 0)}),void 0):null};
//# sourceMappingURL=index.js.map
